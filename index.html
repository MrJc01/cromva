<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cromva | OS</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/1999/xlink%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì¶</text></svg>">
    <script>
        // Silence Tailwind CDN production warning
        if (window.location.host !== 'localhost' && window.location.host !== '127.0.0.1') {
            // This is a hack because the CDN script logs it aggressively
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <script src="js/libs/fabric.min.js"></script>
    <link rel="stylesheet" href="css/index.css">
</head>

<body class="h-screen flex text-sm">

    <div id="toast" class="toast">
        <i data-lucide="check-circle" class="w-4 h-4 text-emerald-500"></i>
        <span id="toast-msg">Opera√ß√£o realizada</span>
    </div>

    <!-- Barra Lateral -->
    <aside id="sidebar"
        class="w-64 glass border-r border-zinc-800 flex flex-col h-full z-20 shadow-xl transition-all duration-300">
        <div class="p-6 flex items-center gap-3">
            <div
                class="w-8 h-8 bg-gradient-to-br from-zinc-100 to-zinc-500 rounded-lg flex items-center justify-center shadow-lg">
                <i data-lucide="box" class="text-zinc-900 w-5 h-5"></i>
            </div>
            <h1 class="text-lg font-bold text-zinc-100 tracking-tight">Cromva</h1>
        </div>

        <nav class="flex-1 px-3 space-y-1 overflow-y-auto custom-scrollbar">
            <div class="px-3 py-2 text-[10px] font-bold text-zinc-500 uppercase tracking-widest mt-2">Workspace</div>

            <button onclick="switchView('grid')" id="nav-grid"
                class="nav-btn w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100 bg-zinc-800/50 text-zinc-100 border border-zinc-700/50">
                <i data-lucide="layout-grid" class="w-4 h-4"></i> Notas
            </button>
            <button onclick="switchView('graph')" id="nav-graph"
                class="nav-btn w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                <i data-lucide="share-2" class="w-4 h-4"></i> Network
            </button>
            <button onclick="switchView('canvas')" id="nav-canvas"
                class="nav-btn w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                <i data-lucide="mouse-pointer-2" class="w-4 h-4"></i> Canvas
            </button>
            <button onclick="switchView('visuals')" id="nav-visuals"
                class="nav-btn w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                <i data-lucide="pie-chart" class="w-4 h-4"></i> Analytics
            </button>

            <div
                class="px-3 py-2 text-[10px] font-bold text-zinc-500 uppercase tracking-widest mt-6 flex justify-between items-center">
                <span>Recentes</span>
                <span class="text-[9px] bg-zinc-800 px-1.5 py-0.5 rounded text-zinc-400" id="recent-count">0</span>
            </div>
            <div id="recent-list" class="space-y-0.5 mt-1"></div>
        </nav>

        <div class="p-4 border-t border-zinc-800/50 bg-zinc-900/30">
            <a href="https://crom.run" target="_blank"
                class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white py-2 rounded-md font-medium transition-all shadow-lg shadow-purple-900/20 text-xs transform hover:scale-[1.02] active:scale-95">
                <i data-lucide="globe" class="w-3.5 h-3.5"></i> Acessar Crom.run
            </a>
        </div>
    </aside>

    <!-- √Årea Principal -->
    <main class="flex-1 flex flex-col relative overflow-hidden bg-[#09090b]">

        <header
            class="h-14 border-b border-zinc-800/50 flex items-center justify-between px-6 bg-zinc-900/20 backdrop-blur-sm z-10">
            <div class="flex items-center gap-4 flex-1">
                <button onclick="toggleSidebar()"
                    class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100 transition-colors"><i
                        data-lucide="menu" class="w-4.5 h-4.5"></i></button>
                <div class="relative w-96 group">
                    <i data-lucide="search"
                        class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500 group-focus-within:text-zinc-300 transition-colors"></i>
                    <input type="text" placeholder="Buscar no Cromva... (Ctrl+K)" readonly
                        onclick="SpotlightManager.open()"
                        class="w-full bg-zinc-900/50 border border-zinc-800 rounded-lg py-1.5 pl-10 pr-4 focus:outline-none focus:ring-1 focus:ring-zinc-600 focus:bg-zinc-900 transition-all text-sm text-zinc-200 placeholder-zinc-600 cursor-pointer">
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="openWorkspaceManager()"
                    class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100 transition-colors"><i
                        data-lucide="folder-open" class="w-4.5 h-4.5"></i></button>
                <button onclick="openSettings()"
                    class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100 transition-colors"><i
                        data-lucide="settings" class="w-4.5 h-4.5"></i></button>
                <div class="h-4 w-px bg-zinc-800 mx-1"></div>
                <div
                    class="w-7 h-7 rounded-md bg-gradient-to-br from-zinc-700 to-zinc-800 border border-zinc-600 flex items-center justify-center text-[10px] font-bold text-zinc-300 shadow-inner">
                    DV</div>
            </div>
        </header>

        <!-- View 1: Grid de Notas -->
        <section id="view-grid"
            class="view-section active h-full overflow-y-auto p-6 custom-scrollbar animate__animated animate__fadeIn">

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 pb-20" id="notes-grid">
            </div>
        </section>

        <!-- View 2: Network Graph -->
        <section id="view-graph" class="view-section h-full relative animate__animated animate__fadeIn">
            <div
                class="absolute top-4 left-4 z-10 glass px-4 py-2 rounded-lg border border-zinc-700 flex items-center gap-3 pointer-events-none">
                <span class="flex items-center gap-2 text-xs text-zinc-300"><span
                        class="w-2 h-2 rounded-full bg-blue-500"></span> Sistema</span>
                <span class="flex items-center gap-2 text-xs text-zinc-300"><span
                        class="w-2 h-2 rounded-full bg-emerald-500"></span> Trabalho</span>
                <span class="flex items-center gap-2 text-xs text-zinc-300"><span
                        class="w-2 h-2 rounded-full bg-amber-500"></span> Design</span>
            </div>

            <canvas id="graph-canvas" class="w-full h-full bg-[#09090b] cursor-crosshair"></canvas>

            <div id="graph-tooltip"
                class="absolute hidden z-50 p-3 glass rounded-lg border-l-4 border-blue-500 shadow-2xl backdrop-blur-md max-w-xs">
                <h4 id="tooltip-title" class="font-bold text-white text-sm mb-1">T√≠tulo</h4>
                <div class="flex items-center gap-2 text-xs text-zinc-400">
                    <span id="tooltip-cat"
                        class="bg-zinc-800 px-1.5 py-0.5 rounded text-[10px] uppercase tracking-wider">Categoria</span>
                    <span class="text-[10px]">Clique para abrir</span>
                </div>
            </div>
        </section>

        <!-- View 3: Infinite Canvas (Miro-like) -->
        <section id="view-canvas"
            class="view-section h-full relative animate__animated animate__fadeIn overflow-hidden bg-[#18181b]">

            <!-- Canvas Lists (Dashboard) -->
            <div id="canvas-dashboard" class="w-full h-full p-8 overflow-y-auto bg-[#09090b] hidden">
                <div class="max-w-7xl mx-auto">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-2">Meus Quadros</h2>
                            <p class="text-zinc-400">Gerencie seus projetos visuais infinitos.</p>
                        </div>
                    </div>

                    <div id="canvas-list-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Cards injected by JS -->
                    </div>
                </div>
            </div>

            <!-- Canvas Container -->
            <div class="flex-1 relative overflow-hidden hidden" id="canvas-wrapper">
                <canvas id="infinite-canvas"></canvas>
            </div>

            <!-- Right Sidebar (Canvas Tools & Inspector) -->
            <!-- Toggle Button (Visible when sidebar is hidden) -->
            <button id="btn-toggle-sidebar" onclick="toggleCanvasSidebar()"
                class="absolute right-4 top-4 z-10 p-2 glass rounded-lg border border-zinc-700 text-zinc-400 hover:text-white hover:bg-zinc-800 transition-all hidden">
                <i data-lucide="panel-right-open" class="w-5 h-5"></i>
            </button>

            <aside id="canvas-sidebar"
                class="w-56 glass border-l border-zinc-800 flex flex-col z-20 transition-all duration-300 h-full">
                <div class="px-4 py-3 border-b border-zinc-800/50 flex items-center justify-between">
                    <h3 class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">Itens</h3>
                    <button onclick="toggleCanvasSidebar()" class="p-1 hover:bg-zinc-800 rounded text-zinc-400">
                        <i data-lucide="panel-right-close" class="w-3.5 h-3.5"></i>
                    </button>
                </div>

                <!-- Add Items Tab -->
                <div id="canvas-tools-panel" class="p-3 grid grid-cols-2 gap-2">
                    <!-- Note -->
                    <div class="draggable-item bg-zinc-800 p-2 rounded-lg flex flex-col items-center gap-1.5 cursor-grab hover:bg-zinc-700 transition-colors border border-zinc-700"
                        draggable="true" data-type="note" onclick="CanvasUI.addObject('note')">
                        <i data-lucide="sticky-note" class="w-5 h-5 text-yellow-400"></i>
                        <span class="text-[9px] text-zinc-300 font-medium">Nota</span>
                    </div>

                    <!-- Text -->
                    <div class="draggable-item bg-zinc-800 p-2 rounded-lg flex flex-col items-center gap-1.5 cursor-grab hover:bg-zinc-700 transition-colors border border-zinc-700"
                        draggable="true" data-type="text" onclick="CanvasUI.addObject('text')">
                        <i data-lucide="type" class="w-5 h-5 text-zinc-400"></i>
                        <span class="text-[9px] text-zinc-300 font-medium">Texto</span>
                    </div>

                    <!-- Image -->
                    <div class="draggable-item bg-zinc-800 p-2 rounded-lg flex flex-col items-center gap-1.5 cursor-grab hover:bg-zinc-700 transition-colors border border-zinc-700"
                        draggable="true" data-type="image" onclick="CanvasUI.addObject('image')">
                        <i data-lucide="image" class="w-5 h-5 text-blue-400"></i>
                        <span class="text-[9px] text-zinc-300 font-medium">Imagem</span>
                    </div>

                    <!-- Draw -->
                    <div class="draggable-item bg-zinc-800 p-2 rounded-lg flex flex-col items-center gap-1.5 cursor-pointer hover:bg-zinc-700 transition-colors border border-zinc-700"
                        id="tool-draw" onclick="CanvasManager.setTool('draw')">
                        <i data-lucide="pencil" class="w-5 h-5 text-emerald-400"></i>
                        <span class="text-[9px] text-zinc-300 font-medium">Desenhar</span>
                    </div>

                    <!-- Reference -->
                    <div class="draggable-item bg-zinc-800 p-2 rounded-lg flex flex-col items-center gap-1.5 cursor-pointer hover:bg-zinc-700 transition-colors border border-zinc-700"
                        draggable="true" id="tool-reference" onclick="CanvasUI.addReference(100, 100)">
                        <i data-lucide="link" class="w-5 h-5 text-purple-400"></i>
                        <span class="text-[9px] text-zinc-300 font-medium">Link</span>
                    </div>

                    <!-- Shapes (New) -->
                    <div class="draggable-item bg-zinc-800 p-2 rounded-lg flex flex-col items-center gap-1.5 cursor-pointer hover:bg-zinc-700 transition-colors border border-zinc-700 relative"
                        id="tool-shapes" onclick="CanvasUI.toggleShapesMenu()">
                        <i data-lucide="shapes" class="w-5 h-5 text-red-500"></i>
                        <span class="text-[9px] text-zinc-300 font-medium">Formas</span>

                        <!-- Shapes Dropdown -->
                        <div id="shapes-menu"
                            class="absolute right-full top-0 mr-2 bg-zinc-900 border border-zinc-700 rounded-lg shadow-xl p-2 grid grid-cols-2 gap-2 w-32 hidden z-50">
                            <button onclick="event.stopPropagation(); CanvasUI.addObject('square')"
                                class="p-2 hover:bg-zinc-800 rounded flex flex-col items-center" title="Quadrado">
                                <i data-lucide="square" class="w-4 h-4 text-zinc-300"></i>
                            </button>
                            <!-- (Keep buttons short for brevity if reused, but need full block for replace) -->
                            <button onclick="event.stopPropagation(); CanvasUI.addObject('circle')"
                                class="p-2 hover:bg-zinc-800 rounded flex flex-col items-center" title="C√≠rculo">
                                <i data-lucide="circle" class="w-4 h-4 text-zinc-300"></i>
                            </button>
                            <button onclick="event.stopPropagation(); CanvasUI.addObject('triangle')"
                                class="p-2 hover:bg-zinc-800 rounded flex flex-col items-center" title="Tri√¢ngulo">
                                <i data-lucide="triangle" class="w-4 h-4 text-zinc-300"></i>
                            </button>
                            <button onclick="event.stopPropagation(); CanvasUI.addObject('diamond')"
                                class="p-2 hover:bg-zinc-800 rounded flex flex-col items-center" title="Losango">
                                <i data-lucide="diamond" class="w-4 h-4 text-zinc-300"></i>
                            </button>
                            <button onclick="event.stopPropagation(); CanvasUI.addObject('arrow')"
                                class="p-2 hover:bg-zinc-800 rounded flex flex-col items-center" title="Seta">
                                <i data-lucide="move-right" class="w-4 h-4 text-zinc-300"></i>
                            </button>
                            <button onclick="event.stopPropagation(); CanvasUI.addObject('line')"
                                class="p-2 hover:bg-zinc-800 rounded flex flex-col items-center" title="Linha">
                                <i data-lucide="minus" class="w-4 h-4 text-zinc-300"></i>
                            </button>
                            <button onclick="event.stopPropagation(); CanvasUI.addObject('star')"
                                class="p-2 hover:bg-zinc-800 rounded flex flex-col items-center" title="Estrela">
                                <i data-lucide="star" class="w-4 h-4 text-zinc-300"></i>
                            </button>
                            <button onclick="event.stopPropagation(); CanvasUI.addObject('hexagon')"
                                class="p-2 hover:bg-zinc-800 rounded flex flex-col items-center" title="Hex√°gono">
                                <i data-lucide="hexagon" class="w-4 h-4 text-zinc-300"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Inspector Panel (Hidden by default) -->
                <div id="canvas-inspector" class="hidden flex-1 flex-col">
                    <div class="p-4 border-b border-zinc-800/50 bg-zinc-900/30">
                        <h4 class="text-xs font-bold text-zinc-100" id="inspector-title">Elemento</h4>
                    </div>
                    <div class="p-4 space-y-4 overflow-y-auto custom-scrollbar" id="inspector-content">
                        <!-- Properties injected here -->
                    </div>
                </div>
            </aside>

            <!-- Floating Controls (Merged Tools + Zoom) -->
            <div
                class="absolute bottom-8 left-1/2 -translate-x-1/2 glass px-2 py-1.5 rounded-full flex items-center gap-2 shadow-2xl border border-zinc-700 z-20 select-none">
                <!-- Select Tool -->
                <button id="tool-select" onclick="CanvasManager.setTool('select')"
                    class="p-2 rounded-full text-zinc-400 hover:text-white hover:bg-zinc-700/50 active-tool transition-all"
                    title="Selecionar (V)">
                    <i data-lucide="mouse-pointer-2" class="w-4 h-4"></i>
                </button>

                <!-- Pan Tool -->
                <button id="tool-pan" onclick="CanvasManager.setTool('pan')"
                    class="p-2 rounded-full text-zinc-400 hover:text-white hover:bg-zinc-700/50 transition-all"
                    title="Mover (H)">
                    <i data-lucide="hand" class="w-4 h-4"></i>
                </button>

                <div class="w-px h-6 bg-zinc-700 mx-1"></div>

                <button onclick="CanvasManager.adjustZoom(-0.1)"
                    class="p-2 hover:bg-zinc-700/50 rounded-full text-zinc-400 hover:text-white"><i data-lucide="minus"
                        class="w-4 h-4"></i></button>
                <span id="zoom-level"
                    class="text-xs text-zinc-500 font-mono my-auto w-12 text-center cursor-pointer hover:text-white"
                    onclick="CanvasManager.resetZoom()">100%</span>
                <button onclick="CanvasManager.adjustZoom(0.1)"
                    class="p-2 hover:bg-zinc-700/50 rounded-full text-zinc-400 hover:text-white"><i data-lucide="plus"
                        class="w-4 h-4"></i></button>
            </div>

            <!-- Custom Context Menu -->
            <div id="canvas-context-menu"
                class="fixed hidden z-50 glass border border-zinc-700 rounded-lg shadow-2xl min-w-[160px] py-1 animate__animated animate__fadeIn animate__faster">
                <!-- Items injected by JS -->
            </div>
        </section>

        <!-- View 4: Analytics -->
        <section id="view-visuals"
            class="view-section h-full p-8 overflow-y-auto custom-scrollbar animate__animated animate__fadeIn">
            <div class="grid grid-cols-1 lg:grid-cols-1 gap-6 h-full">
                <!-- Content injected by JS -->
            </div>
        </section>

    </main>

    <!-- Modal de Editor -->
    <div id="preview-modal"
        class="fixed inset-0 bg-black/60 z-50 hidden items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div id="modal-container"
            class="glass w-full max-w-6xl h-[90vh] rounded-xl overflow-hidden flex flex-col shadow-2xl ring-1 ring-zinc-700 animate__animated animate__zoomIn animate__faster">
            <div
                class="h-14 border-b border-zinc-800 bg-zinc-900/80 flex justify-between items-center px-4 select-none">
                <div class="flex-1 mr-4">
                    <input id="modal-title-input"
                        class="bg-transparent border-none focus:outline-none text-zinc-100 font-bold text-lg w-full placeholder-zinc-600 truncate"
                        value="Sem t√≠tulo">
                </div>
                <div class="bg-zinc-950/50 p-1 rounded-lg border border-zinc-800 flex gap-1 mr-4">
                    <button onclick="setEditorMode('preview')" id="btn-mode-preview"
                        class="px-3 py-1.5 rounded-md text-xs font-medium text-zinc-400 hover:text-zinc-200 transition-all flex items-center gap-2 editor-mode-active"><i
                            data-lucide="eye" class="w-3.5 h-3.5"></i> Ver</button>
                    <button onclick="setEditorMode('edit')" id="btn-mode-edit"
                        class="px-3 py-1.5 rounded-md text-xs font-medium text-zinc-400 hover:text-zinc-200 transition-all flex items-center gap-2"><i
                            data-lucide="edit-3" class="w-3.5 h-3.5"></i> Editar</button>
                    <button onclick="setEditorMode('split')" id="btn-mode-split"
                        class="px-3 py-1.5 rounded-md text-xs font-medium text-zinc-400 hover:text-zinc-200 transition-all flex items-center gap-2"><i
                            data-lucide="columns" class="w-3.5 h-3.5"></i> Split</button>
                </div>
                <div class="flex items-center gap-2">
                    <!-- Category Dropdown -->
                    <div class="relative" id="category-dropdown-container">
                        <button onclick="toggleCategoryDropdown()" id="btn-category-picker"
                            class="px-2 py-1.5 text-zinc-400 hover:text-amber-400 hover:bg-zinc-800 rounded-md transition-colors flex items-center gap-2 text-xs border border-transparent hover:border-zinc-700">
                            <i data-lucide="tag" class="w-3.5 h-3.5"></i>
                            <span id="current-category-label" class="hidden sm:inline">Sistema</span>
                        </button>
                        <div id="category-dropdown"
                            class="absolute top-full right-0 mt-1 w-56 glass border border-zinc-700 rounded-lg shadow-2xl hidden z-50">
                            <div class="p-2 border-b border-zinc-800">
                                <input type="text" id="category-search" placeholder="Buscar ou criar..."
                                    class="w-full bg-zinc-900 border border-zinc-700 rounded px-2 py-1.5 text-xs text-zinc-200 focus:outline-none focus:border-blue-500"
                                    oninput="filterCategories(this.value)">
                            </div>
                            <div id="category-list" class="max-h-48 overflow-y-auto custom-scrollbar p-1">
                                <!-- Categories injected here -->
                            </div>
                            <div class="p-2 border-t border-zinc-800">
                                <button onclick="createNewCategory()" id="btn-create-category"
                                    class="w-full text-left px-2 py-1.5 text-xs text-blue-400 hover:bg-zinc-800 rounded flex items-center gap-2 hidden">
                                    <i data-lucide="plus" class="w-3 h-3"></i>
                                    <span>Criar "<span id="new-category-name"></span>"</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <button onclick="LocationPicker.open()" title="Selecionar Local" id="btn-location-picker"
                        class="px-2 py-1.5 text-zinc-400 hover:text-blue-400 hover:bg-zinc-800 rounded-md transition-colors flex items-center gap-2 text-xs border border-transparent hover:border-zinc-700">
                        <i data-lucide="folder-output" class="w-3.5 h-3.5"></i> <span id="current-location-label"
                            class="hidden sm:inline">Sem local</span>
                    </button>
                    <div class="w-px h-4 bg-zinc-800 mx-1"></div>
                    <button id="btn-save-note" onclick="saveCurrentNote()" title="Salvar altera√ß√µes"
                        class="p-2 text-zinc-400 hover:text-emerald-400 hover:bg-zinc-800 rounded-md transition-colors"><i
                            data-lucide="save" class="w-4 h-4"></i></button>
                    <button onclick="toggleFullscreen()"
                        class="p-2 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800 rounded-md transition-colors"><i
                            data-lucide="maximize" class="w-4 h-4"></i></button>
                    <button onclick="deleteCurrentNote()" title="Excluir Nota"
                        class="p-2 text-zinc-400 hover:text-red-400 hover:bg-zinc-800 rounded-md transition-colors"><i
                            data-lucide="trash-2" class="w-4 h-4"></i></button>
                    <button onclick="closePreview()"
                        class="ml-2 p-2 text-zinc-500 hover:text-zinc-100 hover:bg-zinc-800 rounded-md transition-colors"><i
                            data-lucide="x" class="w-5 h-5"></i></button>
                </div>
            </div>
            <div id="editor-layout" class="flex-1 flex overflow-hidden bg-[#09090b]">
                <div id="pane-edit" class="hidden h-full border-r border-zinc-800 bg-[#09090b]">
                    <textarea id="modal-textarea"
                        class="w-full h-full p-8 bg-transparent text-zinc-300 focus:outline-none font-mono text-sm leading-7 custom-scrollbar resize-none"
                        spellcheck="false"></textarea>
                </div>
                <div id="pane-preview" class="flex-1 h-full overflow-y-auto custom-scrollbar bg-[#09090b]">
                    <div class="max-w-3xl mx-auto py-10 px-8">
                        <div id="modal-content-rendered" class="prose prose-invert prose-zinc max-w-none"></div>
                    </div>
                </div>
            </div>
            <div
                class="h-8 border-t border-zinc-800 bg-zinc-900/50 flex items-center justify-between px-4 text-[10px] text-zinc-500 select-none">
                <div class="flex gap-4">
                    <span id="word-count">0 palavras</span>
                    <span id="char-count">0 caracteres</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                    <span>Sincronizado</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Workspace Manager -->
    <div id="workspace-modal"
        class="fixed inset-0 bg-[#09090b] z-50 hidden flex-col animate__animated animate__zoomIn animate__faster">


        <!-- Content -->
        <div class="flex-1 flex flex-col p-8 overflow-hidden gap-8 max-w-7xl mx-auto w-full">
            <!-- Top: Workspaces -->
            <div class="h-1/3 flex flex-col min-h-[220px]">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xs font-bold text-zinc-500 uppercase tracking-widest">Seus Workspaces</h3>
                    <div class="flex items-center gap-2">
                        <button onclick="triggerImportWorkspace()"
                            class="px-3 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-200 rounded-md text-xs font-medium flex items-center gap-2 transition-all border border-zinc-700 hover:border-zinc-600">
                            <i data-lucide="upload" class="w-3.5 h-3.5"></i> Importar
                        </button>
                        <button onclick="createNewWorkspace()"
                            class="px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-md text-xs font-semibold shadow-lg shadow-blue-900/20 flex items-center gap-2 transition-all"><i
                                data-lucide="plus" class="w-3.5 h-3.5"></i> Novo Workspace</button>
                        <button onclick="closeWorkspaceManager()"
                            class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100"><i
                                data-lucide="x" class="w-5 h-5"></i></button>
                    </div>
                </div>
                <div id="workspace-list" class="flex gap-6 overflow-x-auto pb-6 pt-2 custom-scrollbar px-1">
                    <!-- Workspace Cards injected by JS -->
                </div>
            </div>

            <!-- Bottom: Explorer -->
            <div class="flex-1 flex flex-col glass rounded-xl border border-zinc-800 overflow-hidden shadow-2xl">
                <div
                    class="h-12 bg-zinc-900/80 border-b border-zinc-800 flex items-center px-4 justify-between backdrop-blur-sm">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded bg-zinc-800 flex items-center justify-center text-zinc-400"><i
                                data-lucide="hard-drive" class="w-4 h-4"></i></div>
                        <div>
                            <span id="current-workspace-name"
                                class="font-bold text-zinc-200 text-sm block">Carregando...</span>
                            <span class="text-[10px] text-zinc-500" id="current-workspace-path">/root</span>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <div class="relative group">
                            <i data-lucide="search"
                                class="absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-zinc-500"></i>
                            <input type="text" placeholder="Filtrar arquivos..."
                                class="bg-zinc-950 border border-zinc-800/50 rounded-md py-1.5 pl-8 pr-3 text-xs text-zinc-300 focus:outline-none focus:border-zinc-700 w-48 transition-all">
                        </div>
                        <div class="w-px h-6 bg-zinc-800 mx-2 my-auto"></div>
                        <button onclick="triggerImportMenu()"
                            class="p-1.5 hover:bg-zinc-800 rounded text-zinc-400 hover:text-zinc-100 transition-colors"
                            title="Importar Conte√∫do"><i data-lucide="plus-circle" class="w-4 h-4"></i></button>
                    </div>
                </div>
                <!-- Header Colunas -->
                <div
                    class="grid grid-cols-12 px-4 py-2 bg-zinc-950/30 border-b border-zinc-800/50 text-[10px] font-bold text-zinc-500 uppercase tracking-wider">
                    <div class="col-span-6">Nome</div>
                    <div class="col-span-2">Status</div>
                    <div class="col-span-2">Tamanho</div>
                    <div class="col-span-2 text-right">A√ß√µes</div>
                </div>
                <div class="flex-1 overflow-y-auto custom-scrollbar p-0 bg-[#0c0c0e]" id="explorer-list">
                    <!-- File list injected by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Cria√ß√£o de Workspace -->
    <div id="new-workspace-modal"
        class="fixed inset-0 bg-black/80 z-[60] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster">
        <div
            class="glass p-6 rounded-xl w-full max-w-md border border-zinc-700 shadow-2xl animate__animated animate__zoomIn animate__faster">
            <h3 class="text-lg font-bold text-zinc-100 mb-1">Novo Workspace</h3>
            <p class="text-xs text-zinc-500 mb-4">Crie um novo ambiente para organizar seus arquivos.</p>

            <div class="space-y-4">
                <div>
                    <label class="text-[10px] uppercase font-bold text-zinc-500 tracking-wider mb-1 block">Nome do
                        Workspace</label>
                    <input id="new-workspace-name" type="text" placeholder="Ex: Projetos Pessoais"
                        class="w-full bg-zinc-950/50 border border-zinc-700/50 rounded-lg py-2 px-3 text-sm text-zinc-200 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500/20 transition-all font-medium"
                        autofocus>
                </div>

                <div class="flex justify-end gap-2 mt-6">
                    <button
                        onclick="document.getElementById('new-workspace-modal').classList.add('hidden'); document.getElementById('new-workspace-modal').classList.remove('flex');"
                        class="px-3 py-2 text-xs font-medium text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800 rounded-md transition-colors">Cancelar</button>
                    <button onclick="submitNewWorkspace()"
                        class="px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md text-xs font-semibold shadow-lg shadow-blue-900/20 transition-all">Criar
                        Workspace</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Configura√ß√µes -->
    <div id="settings-modal"
        class="fixed inset-0 bg-black/80 z-[70] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster">
        <div
            class="glass w-full max-w-4xl h-[80vh] rounded-xl flex border border-zinc-700 shadow-2xl overflow-hidden animate__animated animate__zoomIn animate__faster">
            <!-- Sidebar -->
            <aside class="w-64 border-r border-zinc-800 bg-zinc-900/50 flex flex-col">
                <div class="p-6 border-b border-zinc-800/50">
                    <h2 class="text-zinc-100 font-bold flex items-center gap-2"><i data-lucide="settings-2"
                            class="w-5 h-5 text-zinc-400"></i> Configura√ß√µes</h2>
                </div>
                <nav class="flex-1 p-3 space-y-1">
                    <button onclick="switchSettingsTab('general')" id="tab-general"
                        class="settings-tab w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-100 bg-zinc-800/50 border border-zinc-700/50">
                        <i data-lucide="sliders" class="w-4 h-4"></i> Geral
                    </button>
                    <button onclick="switchSettingsTab('appearance')" id="tab-appearance"
                        class="settings-tab w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                        <i data-lucide="palette" class="w-4 h-4"></i> Apar√™ncia
                    </button>
                    <button onclick="switchSettingsTab('system')" id="tab-system"
                        class="settings-tab w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                        <i data-lucide="cpu" class="w-4 h-4"></i> Sistema
                    </button>
                    <button onclick="switchSettingsTab('search')" id="tab-search"
                        class="settings-tab w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                        <i data-lucide="search" class="w-4 h-4"></i> Busca
                    </button>
                    <button onclick="switchSettingsTab('backup')" id="tab-backup"
                        class="settings-tab w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                        <i data-lucide="database" class="w-4 h-4"></i> Dados & Backup
                    </button>
                    <button onclick="switchSettingsTab('advanced')" id="tab-advanced"
                        class="settings-tab w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100 mt-4 border-t border-zinc-800 pt-4">
                        <i data-lucide="terminal" class="w-4 h-4"></i> Avan√ßado
                    </button>
                </nav>
            </aside>

            <!-- Content -->
            <main class="flex-1 flex flex-col bg-[#09090b] relative">
                <header class="h-14 border-b border-zinc-800 flex items-center justify-between px-6 bg-zinc-900/20">
                    <h3 id="settings-title" class="text-zinc-100 font-bold">Geral</h3>
                    <button onclick="closeSettings()"
                        class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100"><i data-lucide="x"
                            class="w-5 h-5"></i></button>
                </header>

                <div class="flex-1 p-8 overflow-y-auto custom-scrollbar">

                    <!-- Tab: General -->
                    <div id="settings-general" class="settings-content space-y-8 animate__animated animate__fadeIn">
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Inicializa√ß√£o
                            </h4>
                            <div class="flex items-center justify-between py-2">
                                <div>
                                    <p class="text-sm text-zinc-300">Abrir dernier workspace</p>
                                    <p class="text-[10px] text-zinc-500">Reabrir automaticamente o √∫ltimo workspace
                                        usado.</p>
                                </div>
                                <div class="w-10 h-5 bg-blue-600 rounded-full relative cursor-pointer">
                                    <div class="absolute right-0.5 top-0.5 w-4 h-4 bg-white rounded-full"></div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between py-2 mt-2">
                                <div>
                                    <p class="text-sm text-zinc-300">Verificar atualiza√ß√µes ao iniciar</p>
                                </div>
                                <div class="w-10 h-5 bg-zinc-700 rounded-full relative cursor-pointer">
                                    <div class="absolute left-0.5 top-0.5 w-4 h-4 bg-zinc-400 rounded-full"></div>
                                </div>
                            </div>
                        </section>

                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Idioma</h4>
                            <select
                                class="w-full bg-zinc-900 border border-zinc-700 rounded-md p-2 text-sm text-zinc-300 focus:outline-none focus:border-zinc-500">
                                <option>Portugu√™s (Brasil)</option>
                                <option>English (US)</option>
                                <option>Espa√±ol</option>
                            </select>
                        </section>
                    </div>

                    <!-- Tab: Search (New) -->
                    <div id="settings-search"
                        class="settings-content hidden space-y-8 animate__animated animate__fadeIn">
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Provedores
                                Ativos</h4>
                            <div class="space-y-3" id="providers-list">
                                <!-- Injected by JS -->
                            </div>
                        </section>
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Buscadores
                                Customizados</h4>
                            <div class="space-y-3 mb-4" id="custom-engines-list">
                                <!-- Injected by JS -->
                            </div>
                            <div class="bg-zinc-900/50 border border-zinc-800 rounded-lg p-4">
                                <h5 class="text-xs font-bold text-zinc-400 mb-3 uppercase tracking-wider">Adicionar Novo
                                </h5>
                                <div class="grid grid-cols-2 gap-3 mb-3">
                                    <input id="new-engine-name" type="text" placeholder="Nome (ex: Google)"
                                        class="bg-zinc-950 border border-zinc-800 rounded px-3 py-2 text-xs text-zinc-200 focus:outline-none focus:border-blue-500">
                                    <input id="new-engine-url" type="text"
                                        placeholder="URL (ex: google.com/search?q={text})"
                                        class="bg-zinc-950 border border-zinc-800 rounded px-3 py-2 text-xs text-zinc-200 focus:outline-none focus:border-blue-500">
                                </div>
                                <button onclick="addCustomEngine()"
                                    class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded text-xs font-bold transition-colors">Adicionar
                                    Motor de Busca</button>
                            </div>
                        </section>
                    </div>

                    <!-- Tab: Appearance -->
                    <div id="settings-appearance"
                        class="settings-content hidden space-y-8 animate__animated animate__fadeIn">
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Tema</h4>
                            <div class="grid grid-cols-3 gap-4">
                                <div class="cursor-pointer">
                                    <div
                                        class="h-20 bg-zinc-950 border-2 border-blue-500 rounded-lg mb-2 relative overflow-hidden group">
                                        <div
                                            class="absolute top-0 left-0 w-full h-4 bg-zinc-900 border-b border-zinc-800">
                                        </div>
                                        <div class="absolute inset-0 flex items-center justify-center">
                                            <div class="w-4 h-4 bg-blue-500 rounded-full shadow-lg shadow-blue-500/50">
                                            </div>
                                        </div>
                                    </div>
                                    <p class="text-xs text-center text-blue-400 font-bold">Cromva Dark</p>
                                </div>
                                <div class="cursor-pointer opacity-50 hover:opacity-100 transition-opacity">
                                    <div
                                        class="h-20 bg-[#1e1e2e] border border-zinc-700 rounded-lg mb-2 relative overflow-hidden">
                                        <div
                                            class="absolute top-0 left-0 w-full h-4 bg-[#181825] border-b border-[#313244]">
                                        </div>
                                    </div>
                                    <p class="text-xs text-center text-zinc-400">Dracula</p>
                                </div>
                                <div class="cursor-pointer opacity-50 hover:opacity-100 transition-opacity">
                                    <div
                                        class="h-20 bg-zinc-100 border border-zinc-300 rounded-lg mb-2 relative overflow-hidden">
                                        <div class="absolute top-0 left-0 w-full h-4 bg-white border-b border-zinc-200">
                                        </div>
                                    </div>
                                    <p class="text-xs text-center text-zinc-400">Light (Experimental)</p>
                                </div>
                            </div>
                        </section>
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Transpar√™ncia
                                (Glassmorphism)</h4>
                            <div class="flex items-center gap-4">
                                <span class="text-xs text-zinc-500">Menos</span>
                                <input type="range"
                                    class="flex-1 h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer" />
                                <span class="text-xs text-zinc-500">Mais</span>
                            </div>
                        </section>
                    </div>

                    <!-- Tab: System -->
                    <div id="settings-system"
                        class="settings-content hidden space-y-8 animate__animated animate__fadeIn">
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Sobre</h4>
                            <div class="flex items-center gap-4 bg-zinc-900/50 p-4 rounded-lg border border-zinc-800">
                                <div
                                    class="w-12 h-12 bg-gradient-to-br from-zinc-100 to-zinc-500 rounded-lg flex items-center justify-center shadow-lg">
                                    <i data-lucide="box" class="text-zinc-900 w-6 h-6"></i>
                                </div>
                                <div>
                                    <h5 class="text-zinc-100 font-bold">Cromva OS</h5>
                                    <p class="text-xs text-zinc-500">Vers√£o 1.0.0 (Alpha)</p>
                                </div>
                            </div>
                        </section>
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Atualiza√ß√µes
                            </h4>
                            <div class="bg-zinc-900/30 p-4 rounded-lg border border-zinc-800 text-center">
                                <p class="text-sm text-zinc-400 mb-4">Voc√™ est√° usando a vers√£o mais recente.</p>
                                <button onclick="checkForUpdates()" id="btn-update"
                                    class="px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-zinc-200 rounded-md text-xs font-medium transition-all flex items-center justify-center gap-2 mx-auto">
                                    <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i> Verificar agora
                                </button>
                            </div>
                        </section>
                    </div>

                    <!-- Tab: Backup -->
                    <div id="settings-backup"
                        class="settings-content hidden space-y-8 animate__animated animate__fadeIn">
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Exportar
                                Dados</h4>
                            <p class="text-xs text-zinc-500 mb-4">Baixe um arquivo JSON contendo todas as suas notas,
                                workspaces e configura√ß√µes.</p>
                            <button onclick="triggerBackup()"
                                class="w-full py-3 bg-zinc-800 hover:bg-zinc-700 text-zinc-100 rounded-lg border border-zinc-700 flex items-center justify-center gap-2 transition-all">
                                <i data-lucide="download" class="w-4 h-4"></i> Criar Backup Local
                            </button>
                        </section>
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Importar</h4>
                            <div
                                class="border-2 border-dashed border-zinc-800 hover:border-zinc-600 rounded-lg p-8 text-center transition-colors cursor-pointer">
                                <i data-lucide="upload-cloud" class="w-8 h-8 text-zinc-600 mx-auto mb-2"></i>
                                <span class="text-xs text-zinc-500">Arraste um arquivo .json ou clique para
                                    selecionar</span>
                            </div>
                        </section>
                    </div>

                    <!-- Tab: Advanced -->
                    <div id="settings-advanced"
                        class="settings-content hidden space-y-8 animate__animated animate__fadeIn">
                        <div class="bg-amber-900/10 border border-amber-900/50 rounded-lg p-4 mb-4">
                            <h4 class="text-amber-500 font-bold flex items-center gap-2 text-sm"><i
                                    data-lucide="alert-triangle" class="w-4 h-4"></i> Zona de Perigo</h4>
                            <p class="text-[10px] text-amber-200/60 mt-1">Altera√ß√µes aqui podem quebrar o sistema. Fa√ßa
                                backup antes de editar.</p>
                        </div>

                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Comportamento
                                de Workspaces</h4>
                            <div class="flex items-center justify-between py-2">
                                <div>
                                    <p class="text-sm text-zinc-300">Auto-adicionar Pastas</p>
                                    <p class="text-[10px] text-zinc-500">Ao abrir uma pasta local, criar automaticamente
                                        um Workspace para ela.</p>
                                </div>
                                <div id="toggle-auto-add" onclick="toggleAutoAddFolder()"
                                    class="w-10 h-5 bg-zinc-700 rounded-full relative cursor-pointer transition-colors">
                                    <div
                                        class="absolute left-0.5 top-0.5 w-4 h-4 bg-zinc-400 rounded-full transition-transform">
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="flex flex-col h-[400px]">
                            <h4
                                class="text-sm font-bold text-zinc-200 mb-2 border-b border-zinc-800 pb-2 flex justify-between items-center">
                                Configura√ß√£o do Sistema (JSON)
                                <button onclick="saveSystemConfig()"
                                    class="text-[10px] bg-blue-600 hover:bg-blue-500 text-white px-2 py-1 rounded">Salvar
                                    & Recarregar</button>
                            </h4>
                            <textarea id="system-config-json"
                                class="flex-1 bg-zinc-950 border border-zinc-800 rounded-lg p-3 font-mono text-xs text-zinc-300 focus:outline-none focus:border-zinc-600 resize-none custom-scrollbar"
                                spellcheck="false"></textarea>
                        </section>
                    </div>

                </div>
            </main>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal"
        class="fixed inset-0 bg-black/80 z-[200] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster">
        <div
            class="glass p-6 rounded-xl w-full max-w-sm border border-red-900/50 shadow-2xl animate__animated animate__zoomIn animate__faster">
            <h3 class="text-lg font-bold text-zinc-100 mb-1 flex items-center gap-2"><i data-lucide="alert-circle"
                    class="text-red-500"></i> Excluir Arquivo?</h3>
            <p class="text-xs text-zinc-400 mb-6">O que voc√™ deseja fazer com <span id="delete-filename"
                    class="font-bold text-zinc-200">arquivo.txt</span>?</p>

            <div class="space-y-3">
                <button onclick="console.log('CLICK REMOVE BTN'); confirmDeleteAction('remove')"
                    class="w-full flex items-center justify-between px-4 py-3 bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 rounded-lg transition-all group">
                    <span class="text-xs font-semibold text-zinc-300 group-hover:text-zinc-100">Remover do Cromva</span>
                    <span class="text-[10px] text-zinc-500">Mant√©m no disco</span>
                </button>

                <button onclick="console.log('CLICK DISK BTN'); confirmDeleteAction('disk')" id="btn-delete-disk"
                    class="w-full flex items-center justify-between px-4 py-3 bg-red-900/10 hover:bg-red-500/20 border border-red-900/30 hover:border-red-500/50 rounded-lg transition-all group">
                    <span class="text-xs font-semibold text-red-400 group-hover:text-red-300">Excluir do Disco</span>
                    <span class="text-[10px] text-red-500/60 group-hover:text-red-400">Irrevers√≠vel</span>
                </button>
            </div>

            <div class="flex justify-center mt-6">
                <button onclick="closeDeleteModal()"
                    class="text-xs text-zinc-500 hover:text-zinc-300 underline underline-offset-2">Cancelar</button>
            </div>
        </div>
    </div>

    </div>

    <!-- Import Modal -->
    <div id="import-modal"
        class="fixed inset-0 bg-black/80 z-[90] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster"
        onclick="document.getElementById('import-modal').classList.add('hidden'); document.getElementById('import-modal').classList.remove('flex')">
        <div class="glass p-6 rounded-xl w-full max-w-sm border border-zinc-700 shadow-2xl animate__animated animate__zoomIn animate__faster"
            onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold text-zinc-100 mb-4 flex items-center gap-2"><i data-lucide="import"
                    class="w-5 h-5 text-blue-500"></i> Importar para Workspace</h3>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="handleImport('file')"
                    class="flex flex-col items-center justify-center gap-3 p-6 bg-zinc-900/50 hover:bg-zinc-800 border border-zinc-800 hover:border-blue-500/50 rounded-xl transition-all group">
                    <div
                        class="w-12 h-12 rounded-full bg-zinc-800 group-hover:bg-blue-500/10 flex items-center justify-center transition-colors">
                        <i data-lucide="file-plus" class="w-6 h-6 text-zinc-400 group-hover:text-blue-400"></i>
                    </div>
                    <span class="text-xs font-bold text-zinc-300 group-hover:text-blue-100">Selecionar Arquivo</span>
                </button>

                <button onclick="handleImport('folder')"
                    class="flex flex-col items-center justify-center gap-3 p-6 bg-zinc-900/50 hover:bg-zinc-800 border border-zinc-800 hover:border-emerald-500/50 rounded-xl transition-all group">
                    <div
                        class="w-12 h-12 rounded-full bg-zinc-800 group-hover:bg-emerald-500/10 flex items-center justify-center transition-colors">
                        <i data-lucide="folder-plus" class="w-6 h-6 text-zinc-400 group-hover:text-emerald-400"></i>
                    </div>
                    <span class="text-xs font-bold text-zinc-300 group-hover:text-emerald-100">Selecionar Pasta</span>
                </button>
            </div>

            <p class="text-[10px] text-zinc-500 text-center mt-6">O conte√∫do ser√° adicionado ao workspace atual.</p>
        </div>
    </div>

    <!-- Spotlight Overlay -->
    <div id="spotlight-overlay"
        class="fixed inset-0 bg-black/60 z-[100] hidden items-start justify-center pt-[15vh] backdrop-blur-sm animate__animated animate__fadeIn animate__faster">
        <div class="glass w-full max-w-2xl rounded-xl border border-zinc-700 shadow-2xl flex flex-col overflow-hidden animate__animated animate__zoomIn animate__faster"
            onclick="event.stopPropagation()">

            <div class="flex items-center gap-3 px-4 py-3 border-b border-zinc-800 bg-zinc-900/80">
                <i data-lucide="search" class="w-5 h-5 text-zinc-400"></i>
                <input id="spotlight-input" type="text"
                    placeholder="Digite para buscar arquivos, calcular ou converter..."
                    class="flex-1 bg-transparent border-none text-zinc-100 text-lg focus:outline-none placeholder-zinc-600"
                    autocomplete="off" spellcheck="false">
                <span
                    class="text-[10px] bg-zinc-800 px-1.5 py-0.5 rounded text-zinc-500 font-mono border border-zinc-700">ESC</span>
            </div>

            <div id="spotlight-results" class="max-h-[60vh] overflow-y-auto custom-scrollbar p-2 bg-[#09090b]">
                <!-- Results injected here -->
                <div class="py-12 text-center text-zinc-500 flex flex-col items-center gap-3 opacity-50">
                    <i data-lucide="command" class="w-8 h-8 opacity-20"></i>
                    <p class="text-sm">O que voc√™ procura hoje?</p>
                </div>
            </div>

            <div
                class="px-3 py-1.5 bg-zinc-900/90 border-t border-zinc-800 flex justify-between items-center text-[10px] text-zinc-500">
                <div class="flex gap-3">
                    <span class="flex items-center gap-1"><i data-lucide="arrow-up" class="w-3 h-3"></i><i
                            data-lucide="arrow-down" class="w-3 h-3"></i> Navegar</span>
                    <span class="flex items-center gap-1"><i data-lucide="corner-down-left" class="w-3 h-3"></i>
                        Selecionar</span>
                </div>
                <div>
                    <span class="bg-blue-500/10 text-blue-400 px-1.5 py-0.5 rounded">Math</span>
                    <span class="bg-emerald-500/10 text-emerald-400 px-1.5 py-0.5 rounded ml-1">Files</span>
                    <span class="bg-amber-500/10 text-amber-400 px-1.5 py-0.5 rounded ml-1">Wiki</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Wiki Modal -->
    <div id="wiki-modal"
        class="fixed inset-0 bg-black/80 z-[110] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster"
        onclick="document.getElementById('wiki-modal').classList.add('hidden'); document.getElementById('wiki-modal').classList.remove('flex')">
        <div class="glass w-full max-w-3xl max-h-[80vh] rounded-xl flex flex-col border border-zinc-700 shadow-2xl overflow-hidden animate__animated animate__zoomIn animate__faster"
            onclick="event.stopPropagation()">
            <header
                class="h-14 border-b border-zinc-800 flex items-center justify-between px-6 bg-zinc-900/90 backdrop-blur">
                <div class="flex items-center gap-3">
                    <i data-lucide="book" class="w-5 h-5 text-pink-500"></i>
                    <h3 id="wiki-title" class="text-zinc-100 font-bold text-lg truncate w-96">Wikip√©dia</h3>
                </div>
                <div class="flex items-center gap-2">
                    <a id="wiki-link" href="#" target="_blank"
                        class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100 transition-colors"
                        title="Abrir no navegador">
                        <i data-lucide="external-link" class="w-4.5 h-4.5"></i>
                    </a>
                    <button
                        onclick="document.getElementById('wiki-modal').classList.add('hidden'); document.getElementById('wiki-modal').classList.remove('flex')"
                        class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100 transition-colors">
                        <i data-lucide="x" class="w-4.5 h-4.5"></i>
                    </button>
                </div>
            </header>
            <div id="wiki-content"
                class="flex-1 p-8 overflow-y-auto custom-scrollbar text-zinc-300 leading-relaxed space-y-4">
                <!-- Content injected here -->
            </div>
        </div>
    </div>

    <!-- Location Picker Modal -->
    <div id="location-picker-modal"
        class="fixed inset-0 bg-black/80 z-[80] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster">
        <div
            class="glass p-6 rounded-xl w-full max-w-lg border border-zinc-700 shadow-2xl animate__animated animate__zoomIn animate__faster">
            <h3 class="text-lg font-bold text-zinc-100 mb-1">Selecionar Local</h3>
            <p class="text-xs text-zinc-500 mb-4">Escolha onde salvar esta nota.</p>

            <!-- Workspace List -->
            <div class="mb-4">
                <label class="text-[10px] uppercase font-bold text-zinc-500 tracking-wider mb-2 block">Workspace</label>
                <div id="lp-workspace-list" class="flex gap-2 overflow-x-auto pb-2 custom-scrollbar">
                    <!-- Injected via JS -->
                </div>
            </div>

            <!-- Folder List -->
            <div class="mb-6">
                <label class="text-[10px] uppercase font-bold text-zinc-500 tracking-wider mb-2 block">Pasta</label>
                <div id="lp-folder-list" class="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto custom-scrollbar p-1">
                    <!-- Injected via JS -->
                </div>
            </div>

            <div class="flex justify-end gap-2 border-t border-zinc-800 pt-4">
                <button onclick="LocationPicker.close()"
                    class="px-3 py-2 text-xs font-medium text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800 rounded-md transition-colors">Cancelar</button>
                <button onclick="LocationPicker.confirm()"
                    class="px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md text-xs font-semibold shadow-lg shadow-blue-900/20 transition-all">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Move/Copy Confirmation Modal -->
    <div id="move-copy-modal"
        class="fixed inset-0 bg-black/80 z-[85] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster">
        <div
            class="glass p-6 rounded-xl w-full max-w-sm border border-zinc-700 shadow-2xl animate__animated animate__zoomIn animate__faster">
            <h3 class="text-lg font-bold text-zinc-100 mb-1 flex items-center gap-2">
                <i data-lucide="folder-sync" class="w-5 h-5 text-blue-500"></i> Alterar Local
            </h3>
            <p class="text-xs text-zinc-400 mb-4">O que voc√™ deseja fazer com o arquivo?</p>

            <div id="move-copy-info" class="bg-zinc-900/50 rounded-lg p-3 mb-4 border border-zinc-800">
                <p class="text-xs text-zinc-500">De: <span id="mc-from" class="text-zinc-300">-</span></p>
                <p class="text-xs text-zinc-500 mt-1">Para: <span id="mc-to" class="text-zinc-300">-</span></p>
            </div>

            <div class="space-y-3">
                <button onclick="LocationPicker.executeMove()"
                    class="w-full flex items-center justify-between px-4 py-3 bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 rounded-lg transition-all group">
                    <div class="flex items-center gap-3">
                        <i data-lucide="move" class="w-4 h-4 text-blue-400"></i>
                        <span class="text-xs font-semibold text-zinc-300 group-hover:text-zinc-100">Mover</span>
                    </div>
                    <span class="text-[10px] text-zinc-500">Remove do local antigo</span>
                </button>

                <button onclick="LocationPicker.executeCopy()"
                    class="w-full flex items-center justify-between px-4 py-3 bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 rounded-lg transition-all group">
                    <div class="flex items-center gap-3">
                        <i data-lucide="copy" class="w-4 h-4 text-emerald-400"></i>
                        <span class="text-xs font-semibold text-zinc-300 group-hover:text-zinc-100">Copiar</span>
                    </div>
                    <span class="text-[10px] text-zinc-500">Mant√©m no local original</span>
                </button>
            </div>

            <div class="flex justify-center mt-4">
                <button onclick="LocationPicker.closeMoveModal()"
                    class="text-xs text-zinc-500 hover:text-zinc-300 underline underline-offset-2">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Core Modules -->
    <script src="js/core/constants.js"></script>
    <script src="js/core/config.js"></script>
    <script src="js/core/events.js"></script>
    <script src="js/core/state.js"></script>
    <script src="js/core/cromva_state.js"></script>
    <script src="js/core/handle_store.js"></script>
    <script src="js/core/fs_handler.js"></script>
    <script src="js/core/file_cache.js"></script>
    <script src="js/core/file_watcher.js"></script>
    <script src="js/core/data_manager.js"></script>
    <script src="js/core/offline.js"></script>
    <script src="js/core/error_handler.js"></script>
    <script src="js/core/module_registry.js"></script>
    <script src="js/core/compression.js"></script>
    <script src="js/core/file_format.js"></script>
    <script src="js/core/editor_namespace.js"></script>
    <script src="js/core/workspace_manager.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/logger.js"></script>
    <script src="js/utils/performance.js"></script>
    <script src="js/utils/diagnostics.js"></script>
    <script src="js/utils/session_recorder.js"></script>
    <script src="js/utils/telemetry.js"></script>
    <script src="js/utils/sorter.js"></script>
    <script src="js/utils/search.js"></script>
    <script src="js/utils/markdown_parser.js"></script>

    <!-- Independent Features -->
    <script src="js/spotlight.js"></script>

    <!-- UI & Navigation -->
    <script src="js/ui/navigation.js"></script>
    <script src="js/ui/keyboard.js"></script>
    <script src="js/ui/modals.js"></script>
    <script src="js/ui/components.js"></script>
    <script src="js/ui/context_menu.js"></script>
    <script src="js/ui/theme.js"></script>
    <script src="js/ui/animations.js"></script>
    <script src="js/ui/breadcrumb.js"></script>
    <script src="js/ui/connection.js"></script>
    <script src="js/ui/file_preview.js"></script>
    <script src="js/ui/onboarding.js"></script>
    <script src="js/ui/workspace_ui.js"></script>
    <script src="js/ui/storage_info.js"></script>

    <!-- Features -->
    <script src="js/features/editor.js"></script>
    <script src="js/features/graph.js"></script>
    <script src="js/features/workspaces.js"></script>
    <script src="js/features/workspace_recovery.js"></script>
    <script src="js/features/settings.js"></script>
    <script src="js/features/location_picker.js"></script>
    <script src="js/features/category_picker.js"></script>
    <script src="js/features/undo_redo.js"></script>
    <script src="js/features/line_counter.js"></script>
    <script src="js/features/toolbar.js"></script>
    <script src="js/features/find_replace.js"></script>
    <script src="js/features/focus_mode.js"></script>
    <script src="js/features/favorites.js"></script>
    <script src="js/features/markdown_preview.js"></script>
    <script src="js/features/multi_select.js"></script>
    <script src="js/features/image_drop.js"></script>
    <script src="js/features/recent_locations.js"></script>
    <script src="js/features/path_preview.js"></script>
    <script src="js/features/folder_navigation.js"></script>
    <script src="js/features/folder_creator.js"></script>
    <script src="js/features/batch_selection.js"></script>
    <script src="js/features/editor_renderer.js"></script>
    <script src="js/features/picker_unified.js"></script>

    <!-- Main Entry Point -->
    <script src="js/features/canvas_manager.js"></script>
    <script src="js/features/canvas_objects.js"></script>
    <script src="js/features/canvas_navigator.js"></script>
    <script src="js/features/canvas_list.js"></script>
    <script src="js/features/canvas_ui.js"></script>
    <script src="js/features/board_persistence.js"></script>
    <script src="js/features/analytics.js"></script>
    <script src="js/main.js"></script>
    <script src="scripts/debug.js"></script>
    <script src="js/utils/debug_panel.js"></script>

    <!-- Test Scripts (Development) -->
    <script src="scripts/runner.js"></script>
    <script src="scripts/code_standards.js"></script>
    <script src="scripts/bug_tracker.js"></script>
    <script src="scripts/tests/test-state.js"></script>
    <script src="scripts/tests/test-editor.js"></script>
    <script src="scripts/tests/test-fs.js"></script>
    <script src="scripts/tests/test-workspaces.js"></script>
    <script src="scripts/tests/test-location.js"></script>
    <script src="scripts/tests/test-navigation.js"></script>
    <script src="scripts/tests/test-spotlight.js"></script>
    <script src="scripts/tests/test-settings.js"></script>
    <script src="scripts/tests/test-graph.js"></script>
    <script src="scripts/tests/test-canvas.js"></script>
    <script src="scripts/tests/test-integration.js"></script>

    <!-- Create Board Modal -->
    <div id="create-board-modal"
        class="fixed inset-0 bg-black/80 z-[100] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster">
        <div
            class="glass p-6 rounded-xl w-full max-w-md border border-zinc-700 shadow-2xl animate__animated animate__zoomIn animate__faster">
            <h3 class="text-xl font-bold text-zinc-100 mb-2">Novo Quadro</h3>
            <p class="text-sm text-zinc-400 mb-6">D√™ um nome para o seu novo espa√ßo criativo.</p>

            <div class="mb-6">
                <label class="text-[10px] uppercase font-bold text-zinc-500 tracking-wider mb-2 block">Nome do
                    Quadro</label>
                <input type="text" id="new-board-name"
                    class="w-full bg-zinc-900 border border-zinc-800 rounded-lg px-4 py-3 text-zinc-200 outline-none focus:border-emerald-500 transition-colors placeholder:text-zinc-600"
                    placeholder="Ex: Planejamento Q3">
            </div>

            <div class="flex justify-end gap-3">
                <button onclick="CanvasList.closeCreateModal()"
                    class="px-4 py-2 text-sm font-medium text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800 rounded-lg transition-colors">Cancelar</button>
                <button onclick="CanvasList.confirmCreateBoard()"
                    class="px-4 py-2 text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg transition-colors shadow-lg shadow-emerald-900/20">Criar
                    Quadro</button>
            </div>
        </div>
    </div>
</body>

</html>