<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cromva | OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link rel="stylesheet" href="css/index.css">
</head>

<body class="h-screen flex text-sm">

    <div id="toast" class="toast">
        <i data-lucide="check-circle" class="w-4 h-4 text-emerald-500"></i>
        <span id="toast-msg">Operação realizada</span>
    </div>

    <!-- Barra Lateral -->
    <aside id="sidebar"
        class="w-64 glass border-r border-zinc-800 flex flex-col h-full z-20 shadow-xl transition-all duration-300">
        <div class="p-6 flex items-center gap-3">
            <div
                class="w-8 h-8 bg-gradient-to-br from-zinc-100 to-zinc-500 rounded-lg flex items-center justify-center shadow-lg">
                <i data-lucide="box" class="text-zinc-900 w-5 h-5"></i>
            </div>
            <h1 class="text-lg font-bold text-zinc-100 tracking-tight">Cromva</h1>
        </div>

        <nav class="flex-1 px-3 space-y-1 overflow-y-auto custom-scrollbar">
            <div class="px-3 py-2 text-[10px] font-bold text-zinc-500 uppercase tracking-widest mt-2">Workspace</div>

            <button onclick="switchView('grid')" id="nav-grid"
                class="nav-btn w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100 bg-zinc-800/50 text-zinc-100 border border-zinc-700/50">
                <i data-lucide="layout-grid" class="w-4 h-4"></i> Notas
            </button>
            <button onclick="switchView('graph')" id="nav-graph"
                class="nav-btn w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                <i data-lucide="share-2" class="w-4 h-4"></i> Network
            </button>
            <button onclick="switchView('canvas')" id="nav-canvas"
                class="nav-btn w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                <i data-lucide="mouse-pointer-2" class="w-4 h-4"></i> Canvas
            </button>
            <button onclick="switchView('visuals')" id="nav-visuals"
                class="nav-btn w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                <i data-lucide="pie-chart" class="w-4 h-4"></i> Analytics
            </button>

            <div
                class="px-3 py-2 text-[10px] font-bold text-zinc-500 uppercase tracking-widest mt-6 flex justify-between items-center">
                <span>Recentes</span>
                <span class="text-[9px] bg-zinc-800 px-1.5 py-0.5 rounded text-zinc-400" id="recent-count">0</span>
            </div>
            <div id="recent-list" class="space-y-0.5 mt-1"></div>
        </nav>

        <div class="p-4 border-t border-zinc-800/50 bg-zinc-900/30">
            <button
                class="w-full flex items-center justify-center gap-2 bg-zinc-100 hover:bg-white text-zinc-950 py-2 rounded-md font-medium transition-all shadow-lg shadow-zinc-900/20 text-xs">
                <i data-lucide="github" class="w-3.5 h-3.5"></i> Sincronizar GitHub
            </button>
        </div>
    </aside>

    <!-- Área Principal -->
    <main class="flex-1 flex flex-col relative overflow-hidden bg-[#09090b]">

        <header
            class="h-14 border-b border-zinc-800/50 flex items-center justify-between px-6 bg-zinc-900/20 backdrop-blur-sm z-10">
            <div class="flex items-center gap-4 flex-1">
                <button onclick="toggleSidebar()"
                    class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100 transition-colors"><i
                        data-lucide="menu" class="w-4.5 h-4.5"></i></button>
                <div class="relative w-96 group">
                    <i data-lucide="search"
                        class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500 group-focus-within:text-zinc-300 transition-colors"></i>
                    <input type="text" placeholder="Buscar no Cromva... (Ctrl+K)" readonly
                        onclick="SpotlightManager.open()"
                        class="w-full bg-zinc-900/50 border border-zinc-800 rounded-lg py-1.5 pl-10 pr-4 focus:outline-none focus:ring-1 focus:ring-zinc-600 focus:bg-zinc-900 transition-all text-sm text-zinc-200 placeholder-zinc-600 cursor-pointer">
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="openWorkspaceManager()"
                    class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100 transition-colors"><i
                        data-lucide="folder-open" class="w-4.5 h-4.5"></i></button>
                <button onclick="openSettings()"
                    class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100 transition-colors"><i
                        data-lucide="settings" class="w-4.5 h-4.5"></i></button>
                <div class="h-4 w-px bg-zinc-800 mx-1"></div>
                <div
                    class="w-7 h-7 rounded-md bg-gradient-to-br from-zinc-700 to-zinc-800 border border-zinc-600 flex items-center justify-center text-[10px] font-bold text-zinc-300 shadow-inner">
                    DV</div>
            </div>
        </header>

        <!-- View 1: Grid de Notas -->
        <section id="view-grid"
            class="view-section active h-full overflow-y-auto p-6 custom-scrollbar animate__animated animate__fadeIn">
            <div class="max-w-3xl mx-auto mb-12">
                <div
                    class="glass p-1 rounded-xl shadow-2xl border border-zinc-800 group transition-all duration-300 focus-within:ring-1 focus-within:ring-zinc-700">
                    <div class="p-4">
                        <input id="quick-title" type="text" placeholder="Título da nova ideia..."
                            class="w-full bg-transparent text-lg font-bold mb-2 focus:outline-none hidden group-focus-within:block text-white placeholder-zinc-600">
                        <textarea id="quick-content" placeholder="Criar uma nota..."
                            class="w-full bg-transparent resize-none focus:outline-none text-zinc-300 placeholder-zinc-500 text-sm leading-relaxed"
                            rows="1"></textarea>
                    </div>
                    <div
                        class="hidden group-focus-within:flex justify-between items-center px-4 pb-3 pt-1 border-t border-zinc-800/50 animate__animated animate__fadeIn">
                        <button onclick="triggerImportMenu()"
                            class="p-1.5 hover:bg-zinc-800 rounded text-zinc-400 hover:text-zinc-100 transition-colors"
                            title="Importar Conteúdo"><i data-lucide="plus-circle" class="w-4 h-4"></i></button>
                        <button onclick="quickSaveNote()"
                            class="px-4 py-1.5 bg-zinc-100 hover:bg-white text-zinc-950 rounded-md text-xs font-semibold shadow-lg transition-all transform active:scale-95">Criar
                            Nota</button>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 pb-20" id="notes-grid">
            </div>
        </section>

        <!-- View 2: Network Graph -->
        <section id="view-graph" class="view-section h-full relative animate__animated animate__fadeIn">
            <div
                class="absolute top-4 left-4 z-10 glass px-4 py-2 rounded-lg border border-zinc-700 flex items-center gap-3 pointer-events-none">
                <span class="flex items-center gap-2 text-xs text-zinc-300"><span
                        class="w-2 h-2 rounded-full bg-blue-500"></span> Sistema</span>
                <span class="flex items-center gap-2 text-xs text-zinc-300"><span
                        class="w-2 h-2 rounded-full bg-emerald-500"></span> Trabalho</span>
                <span class="flex items-center gap-2 text-xs text-zinc-300"><span
                        class="w-2 h-2 rounded-full bg-amber-500"></span> Design</span>
            </div>

            <canvas id="graph-canvas" class="w-full h-full bg-[#09090b] cursor-crosshair"></canvas>

            <div id="graph-tooltip"
                class="absolute hidden z-50 p-3 glass rounded-lg border-l-4 border-blue-500 shadow-2xl backdrop-blur-md max-w-xs">
                <h4 id="tooltip-title" class="font-bold text-white text-sm mb-1">Título</h4>
                <div class="flex items-center gap-2 text-xs text-zinc-400">
                    <span id="tooltip-cat"
                        class="bg-zinc-800 px-1.5 py-0.5 rounded text-[10px] uppercase tracking-wider">Categoria</span>
                    <span class="text-[10px]">Clique para abrir</span>
                </div>
            </div>
        </section>

        <!-- View 3: Infinite Canvas (Miro-like) -->
        <section id="view-canvas"
            class="view-section h-full relative animate__animated animate__fadeIn overflow-hidden bg-[#18181b]">
            <div id="infinite-canvas"
                class="w-[5000px] h-[5000px] relative top-0 left-0 transition-transform duration-75 ease-out">
                <!-- Itens serão gerados via JS aqui -->
            </div>

            <div
                class="absolute bottom-8 left-1/2 -translate-x-1/2 glass px-4 py-2 rounded-full flex gap-4 shadow-2xl border border-zinc-700 z-20 select-none">
                <button class="p-2 hover:bg-zinc-700/50 rounded-full text-zinc-400 hover:text-white"
                    title="Mover (Espaço + Drag)"><i data-lucide="hand" class="w-4 h-4"></i></button>
                <div class="w-px h-6 bg-zinc-700 my-auto"></div>
                <button onclick="adjustZoom(-0.1)"
                    class="p-2 hover:bg-zinc-700/50 rounded-full text-zinc-400 hover:text-white"><i data-lucide="minus"
                        class="w-4 h-4"></i></button>
                <span id="zoom-level"
                    class="text-xs text-zinc-500 font-mono my-auto w-12 text-center cursor-pointer hover:text-white"
                    onclick="resetZoom()">100%</span>
                <button onclick="adjustZoom(0.1)"
                    class="p-2 hover:bg-zinc-700/50 rounded-full text-zinc-400 hover:text-white"><i data-lucide="plus"
                        class="w-4 h-4"></i></button>
            </div>
        </section>

        <!-- View 4: Analytics -->
        <section id="view-visuals"
            class="view-section h-full p-8 overflow-y-auto custom-scrollbar animate__animated animate__fadeIn">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 h-full">
                <div
                    class="glass rounded-xl p-8 flex flex-col items-center justify-center relative overflow-hidden group border border-zinc-800">
                    <h3 class="text-zinc-500 text-[10px] font-bold uppercase tracking-widest mb-10 z-10">Frequência de
                        Termos</h3>
                    <div class="flex flex-wrap gap-x-6 gap-y-3 justify-center items-center max-w-md z-10">
                        <span class="text-5xl font-bold text-zinc-100">Cromva</span>
                        <span class="text-2xl font-medium text-zinc-500">Markdown</span>
                        <span class="text-3xl font-semibold text-zinc-300">Design</span>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Modal de Editor -->
    <div id="preview-modal"
        class="fixed inset-0 bg-black/60 z-50 hidden items-center justify-center backdrop-blur-sm transition-all duration-300">
        <div id="modal-container"
            class="glass w-full max-w-6xl h-[90vh] rounded-xl overflow-hidden flex flex-col shadow-2xl ring-1 ring-zinc-700 animate__animated animate__zoomIn animate__faster">
            <div
                class="h-14 border-b border-zinc-800 bg-zinc-900/80 flex justify-between items-center px-4 select-none">
                <div class="flex-1 mr-4">
                    <input id="modal-title-input"
                        class="bg-transparent border-none focus:outline-none text-zinc-100 font-bold text-lg w-full placeholder-zinc-600 truncate"
                        value="Sem título">
                </div>
                <div class="bg-zinc-950/50 p-1 rounded-lg border border-zinc-800 flex gap-1 mr-4">
                    <button onclick="setEditorMode('preview')" id="btn-mode-preview"
                        class="px-3 py-1.5 rounded-md text-xs font-medium text-zinc-400 hover:text-zinc-200 transition-all flex items-center gap-2 editor-mode-active"><i
                            data-lucide="eye" class="w-3.5 h-3.5"></i> Ver</button>
                    <button onclick="setEditorMode('edit')" id="btn-mode-edit"
                        class="px-3 py-1.5 rounded-md text-xs font-medium text-zinc-400 hover:text-zinc-200 transition-all flex items-center gap-2"><i
                            data-lucide="edit-3" class="w-3.5 h-3.5"></i> Editar</button>
                    <button onclick="setEditorMode('split')" id="btn-mode-split"
                        class="px-3 py-1.5 rounded-md text-xs font-medium text-zinc-400 hover:text-zinc-200 transition-all flex items-center gap-2"><i
                            data-lucide="columns" class="w-3.5 h-3.5"></i> Split</button>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="LocationPicker.open()" title="Selecionar Local" id="btn-location-picker"
                        class="px-2 py-1.5 text-zinc-400 hover:text-blue-400 hover:bg-zinc-800 rounded-md transition-colors flex items-center gap-2 text-xs border border-transparent hover:border-zinc-700">
                        <i data-lucide="folder-output" class="w-3.5 h-3.5"></i> <span id="current-location-label"
                            class="hidden sm:inline">Sem local</span>
                    </button>
                    <div class="w-px h-4 bg-zinc-800 mx-1"></div>
                    <button onclick="saveCurrentNote()"
                        class="p-2 text-zinc-400 hover:text-emerald-400 hover:bg-zinc-800 rounded-md transition-colors"><i
                            data-lucide="save" class="w-4 h-4"></i></button>
                    <button onclick="toggleFullscreen()"
                        class="p-2 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800 rounded-md transition-colors"><i
                            data-lucide="maximize" class="w-4 h-4"></i></button>
                    <button onclick="deleteCurrentNote()" title="Excluir Nota"
                        class="p-2 text-zinc-400 hover:text-red-400 hover:bg-zinc-800 rounded-md transition-colors"><i
                            data-lucide="trash-2" class="w-4 h-4"></i></button>
                    <button onclick="closePreview()"
                        class="ml-2 p-2 text-zinc-500 hover:text-zinc-100 hover:bg-zinc-800 rounded-md transition-colors"><i
                            data-lucide="x" class="w-5 h-5"></i></button>
                </div>
            </div>
            <div id="editor-layout" class="flex-1 flex overflow-hidden bg-[#09090b]">
                <div id="pane-edit" class="hidden h-full border-r border-zinc-800 bg-[#09090b]">
                    <textarea id="modal-textarea"
                        class="w-full h-full p-8 bg-transparent text-zinc-300 focus:outline-none font-mono text-sm leading-7 custom-scrollbar resize-none"
                        spellcheck="false"></textarea>
                </div>
                <div id="pane-preview" class="flex-1 h-full overflow-y-auto custom-scrollbar bg-[#09090b]">
                    <div class="max-w-3xl mx-auto py-10 px-8">
                        <div id="modal-content-rendered" class="prose prose-invert prose-zinc max-w-none"></div>
                    </div>
                </div>
            </div>
            <div
                class="h-8 border-t border-zinc-800 bg-zinc-900/50 flex items-center justify-between px-4 text-[10px] text-zinc-500 select-none">
                <div class="flex gap-4">
                    <span id="word-count">0 palavras</span>
                    <span id="char-count">0 caracteres</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                    <span>Sincronizado</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Workspace Manager -->
    <div id="workspace-modal"
        class="fixed inset-0 bg-[#09090b] z-50 hidden flex-col animate__animated animate__zoomIn animate__faster">


        <!-- Content -->
        <div class="flex-1 flex flex-col p-8 overflow-hidden gap-8 max-w-7xl mx-auto w-full">
            <!-- Top: Workspaces -->
            <div class="h-1/3 flex flex-col min-h-[220px]">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xs font-bold text-zinc-500 uppercase tracking-widest">Seus Workspaces</h3>
                    <div class="flex items-center gap-2">
                        <button onclick="createNewWorkspace()"
                            class="px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-md text-xs font-semibold shadow-lg shadow-blue-900/20 flex items-center gap-2 transition-all"><i
                                data-lucide="plus" class="w-3.5 h-3.5"></i> Novo Workspace</button>
                        <button onclick="closeWorkspaceManager()"
                            class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100"><i
                                data-lucide="x" class="w-5 h-5"></i></button>
                    </div>
                </div>
                <div id="workspace-list" class="flex gap-6 overflow-x-auto pb-6 pt-2 custom-scrollbar px-1">
                    <!-- Workspace Cards injected by JS -->
                </div>
            </div>

            <!-- Bottom: Explorer -->
            <div class="flex-1 flex flex-col glass rounded-xl border border-zinc-800 overflow-hidden shadow-2xl">
                <div
                    class="h-12 bg-zinc-900/80 border-b border-zinc-800 flex items-center px-4 justify-between backdrop-blur-sm">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded bg-zinc-800 flex items-center justify-center text-zinc-400"><i
                                data-lucide="hard-drive" class="w-4 h-4"></i></div>
                        <div>
                            <span id="current-workspace-name"
                                class="font-bold text-zinc-200 text-sm block">Carregando...</span>
                            <span class="text-[10px] text-zinc-500" id="current-workspace-path">/root</span>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <div class="relative group">
                            <i data-lucide="search"
                                class="absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-zinc-500"></i>
                            <input type="text" placeholder="Filtrar arquivos..."
                                class="bg-zinc-950 border border-zinc-800/50 rounded-md py-1.5 pl-8 pr-3 text-xs text-zinc-300 focus:outline-none focus:border-zinc-700 w-48 transition-all">
                        </div>
                        <div class="w-px h-6 bg-zinc-800 mx-2 my-auto"></div>
                        <button onclick="triggerImportMenu()"
                            class="p-1.5 hover:bg-zinc-800 rounded text-zinc-400 hover:text-zinc-100 transition-colors"
                            title="Importar Conteúdo"><i data-lucide="plus-circle" class="w-4 h-4"></i></button>
                    </div>
                </div>
                <!-- Header Colunas -->
                <div
                    class="grid grid-cols-12 px-4 py-2 bg-zinc-950/30 border-b border-zinc-800/50 text-[10px] font-bold text-zinc-500 uppercase tracking-wider">
                    <div class="col-span-6">Nome</div>
                    <div class="col-span-2">Status</div>
                    <div class="col-span-2">Tamanho</div>
                    <div class="col-span-2 text-right">Ações</div>
                </div>
                <div class="flex-1 overflow-y-auto custom-scrollbar p-0 bg-[#0c0c0e]" id="explorer-list">
                    <!-- File list injected by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Criação de Workspace -->
    <div id="new-workspace-modal"
        class="fixed inset-0 bg-black/80 z-[60] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster">
        <div
            class="glass p-6 rounded-xl w-full max-w-md border border-zinc-700 shadow-2xl animate__animated animate__zoomIn animate__faster">
            <h3 class="text-lg font-bold text-zinc-100 mb-1">Novo Workspace</h3>
            <p class="text-xs text-zinc-500 mb-4">Crie um novo ambiente para organizar seus arquivos.</p>

            <div class="space-y-4">
                <div>
                    <label class="text-[10px] uppercase font-bold text-zinc-500 tracking-wider mb-1 block">Nome do
                        Workspace</label>
                    <input id="new-workspace-name" type="text" placeholder="Ex: Projetos Pessoais"
                        class="w-full bg-zinc-950/50 border border-zinc-700/50 rounded-lg py-2 px-3 text-sm text-zinc-200 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500/20 transition-all font-medium"
                        autofocus>
                </div>

                <div class="flex justify-end gap-2 mt-6">
                    <button
                        onclick="document.getElementById('new-workspace-modal').classList.add('hidden'); document.getElementById('new-workspace-modal').classList.remove('flex');"
                        class="px-3 py-2 text-xs font-medium text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800 rounded-md transition-colors">Cancelar</button>
                    <button onclick="submitNewWorkspace()"
                        class="px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md text-xs font-semibold shadow-lg shadow-blue-900/20 transition-all">Criar
                        Workspace</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Configurações -->
    <div id="settings-modal"
        class="fixed inset-0 bg-black/80 z-[70] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster">
        <div
            class="glass w-full max-w-4xl h-[80vh] rounded-xl flex border border-zinc-700 shadow-2xl overflow-hidden animate__animated animate__zoomIn animate__faster">
            <!-- Sidebar -->
            <aside class="w-64 border-r border-zinc-800 bg-zinc-900/50 flex flex-col">
                <div class="p-6 border-b border-zinc-800/50">
                    <h2 class="text-zinc-100 font-bold flex items-center gap-2"><i data-lucide="settings-2"
                            class="w-5 h-5 text-zinc-400"></i> Configurações</h2>
                </div>
                <nav class="flex-1 p-3 space-y-1">
                    <button onclick="switchSettingsTab('general')" id="tab-general"
                        class="settings-tab w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-100 bg-zinc-800/50 border border-zinc-700/50">
                        <i data-lucide="sliders" class="w-4 h-4"></i> Geral
                    </button>
                    <button onclick="switchSettingsTab('appearance')" id="tab-appearance"
                        class="settings-tab w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                        <i data-lucide="palette" class="w-4 h-4"></i> Aparência
                    </button>
                    <button onclick="switchSettingsTab('system')" id="tab-system"
                        class="settings-tab w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                        <i data-lucide="cpu" class="w-4 h-4"></i> Sistema
                    </button>
                    <button onclick="switchSettingsTab('search')" id="tab-search"
                        class="settings-tab w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                        <i data-lucide="search" class="w-4 h-4"></i> Busca
                    </button>
                    <button onclick="switchSettingsTab('backup')" id="tab-backup"
                        class="settings-tab w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100">
                        <i data-lucide="database" class="w-4 h-4"></i> Dados & Backup
                    </button>
                    <button onclick="switchSettingsTab('advanced')" id="tab-advanced"
                        class="settings-tab w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-zinc-800/50 transition-colors text-zinc-400 hover:text-zinc-100 mt-4 border-t border-zinc-800 pt-4">
                        <i data-lucide="terminal" class="w-4 h-4"></i> Avançado
                    </button>
                </nav>
            </aside>

            <!-- Content -->
            <main class="flex-1 flex flex-col bg-[#09090b] relative">
                <header class="h-14 border-b border-zinc-800 flex items-center justify-between px-6 bg-zinc-900/20">
                    <h3 id="settings-title" class="text-zinc-100 font-bold">Geral</h3>
                    <button onclick="closeSettings()"
                        class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100"><i data-lucide="x"
                            class="w-5 h-5"></i></button>
                </header>

                <div class="flex-1 p-8 overflow-y-auto custom-scrollbar">

                    <!-- Tab: General -->
                    <div id="settings-general" class="settings-content space-y-8 animate__animated animate__fadeIn">
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Inicialização
                            </h4>
                            <div class="flex items-center justify-between py-2">
                                <div>
                                    <p class="text-sm text-zinc-300">Abrir dernier workspace</p>
                                    <p class="text-[10px] text-zinc-500">Reabrir automaticamente o último workspace
                                        usado.</p>
                                </div>
                                <div class="w-10 h-5 bg-blue-600 rounded-full relative cursor-pointer">
                                    <div class="absolute right-0.5 top-0.5 w-4 h-4 bg-white rounded-full"></div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between py-2 mt-2">
                                <div>
                                    <p class="text-sm text-zinc-300">Verificar atualizações ao iniciar</p>
                                </div>
                                <div class="w-10 h-5 bg-zinc-700 rounded-full relative cursor-pointer">
                                    <div class="absolute left-0.5 top-0.5 w-4 h-4 bg-zinc-400 rounded-full"></div>
                                </div>
                            </div>
                        </section>

                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Idioma</h4>
                            <select
                                class="w-full bg-zinc-900 border border-zinc-700 rounded-md p-2 text-sm text-zinc-300 focus:outline-none focus:border-zinc-500">
                                <option>Português (Brasil)</option>
                                <option>English (US)</option>
                                <option>Español</option>
                            </select>
                        </section>
                    </div>

                    <!-- Tab: Search (New) -->
                    <div id="settings-search"
                        class="settings-content hidden space-y-8 animate__animated animate__fadeIn">
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Provedores
                                Ativos</h4>
                            <div class="space-y-3" id="providers-list">
                                <!-- Injected by JS -->
                            </div>
                        </section>
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Buscadores
                                Customizados</h4>
                            <div class="space-y-3 mb-4" id="custom-engines-list">
                                <!-- Injected by JS -->
                            </div>
                            <div class="bg-zinc-900/50 border border-zinc-800 rounded-lg p-4">
                                <h5 class="text-xs font-bold text-zinc-400 mb-3 uppercase tracking-wider">Adicionar Novo
                                </h5>
                                <div class="grid grid-cols-2 gap-3 mb-3">
                                    <input id="new-engine-name" type="text" placeholder="Nome (ex: Google)"
                                        class="bg-zinc-950 border border-zinc-800 rounded px-3 py-2 text-xs text-zinc-200 focus:outline-none focus:border-blue-500">
                                    <input id="new-engine-url" type="text"
                                        placeholder="URL (ex: google.com/search?q={text})"
                                        class="bg-zinc-950 border border-zinc-800 rounded px-3 py-2 text-xs text-zinc-200 focus:outline-none focus:border-blue-500">
                                </div>
                                <button onclick="addCustomEngine()"
                                    class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded text-xs font-bold transition-colors">Adicionar
                                    Motor de Busca</button>
                            </div>
                        </section>
                    </div>

                    <!-- Tab: Appearance -->
                    <div id="settings-appearance"
                        class="settings-content hidden space-y-8 animate__animated animate__fadeIn">
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Tema</h4>
                            <div class="grid grid-cols-3 gap-4">
                                <div class="cursor-pointer">
                                    <div
                                        class="h-20 bg-zinc-950 border-2 border-blue-500 rounded-lg mb-2 relative overflow-hidden group">
                                        <div
                                            class="absolute top-0 left-0 w-full h-4 bg-zinc-900 border-b border-zinc-800">
                                        </div>
                                        <div class="absolute inset-0 flex items-center justify-center">
                                            <div class="w-4 h-4 bg-blue-500 rounded-full shadow-lg shadow-blue-500/50">
                                            </div>
                                        </div>
                                    </div>
                                    <p class="text-xs text-center text-blue-400 font-bold">Cromva Dark</p>
                                </div>
                                <div class="cursor-pointer opacity-50 hover:opacity-100 transition-opacity">
                                    <div
                                        class="h-20 bg-[#1e1e2e] border border-zinc-700 rounded-lg mb-2 relative overflow-hidden">
                                        <div
                                            class="absolute top-0 left-0 w-full h-4 bg-[#181825] border-b border-[#313244]">
                                        </div>
                                    </div>
                                    <p class="text-xs text-center text-zinc-400">Dracula</p>
                                </div>
                                <div class="cursor-pointer opacity-50 hover:opacity-100 transition-opacity">
                                    <div
                                        class="h-20 bg-zinc-100 border border-zinc-300 rounded-lg mb-2 relative overflow-hidden">
                                        <div class="absolute top-0 left-0 w-full h-4 bg-white border-b border-zinc-200">
                                        </div>
                                    </div>
                                    <p class="text-xs text-center text-zinc-400">Light (Experimental)</p>
                                </div>
                            </div>
                        </section>
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Transparência
                                (Glassmorphism)</h4>
                            <div class="flex items-center gap-4">
                                <span class="text-xs text-zinc-500">Menos</span>
                                <input type="range"
                                    class="flex-1 h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer" />
                                <span class="text-xs text-zinc-500">Mais</span>
                            </div>
                        </section>
                    </div>

                    <!-- Tab: System -->
                    <div id="settings-system"
                        class="settings-content hidden space-y-8 animate__animated animate__fadeIn">
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Sobre</h4>
                            <div class="flex items-center gap-4 bg-zinc-900/50 p-4 rounded-lg border border-zinc-800">
                                <div
                                    class="w-12 h-12 bg-gradient-to-br from-zinc-100 to-zinc-500 rounded-lg flex items-center justify-center shadow-lg">
                                    <i data-lucide="box" class="text-zinc-900 w-6 h-6"></i>
                                </div>
                                <div>
                                    <h5 class="text-zinc-100 font-bold">Cromva OS</h5>
                                    <p class="text-xs text-zinc-500">Versão 1.0.0 (Alpha)</p>
                                </div>
                            </div>
                        </section>
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Atualizações
                            </h4>
                            <div class="bg-zinc-900/30 p-4 rounded-lg border border-zinc-800 text-center">
                                <p class="text-sm text-zinc-400 mb-4">Você está usando a versão mais recente.</p>
                                <button onclick="checkForUpdates()" id="btn-update"
                                    class="px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-zinc-200 rounded-md text-xs font-medium transition-all flex items-center justify-center gap-2 mx-auto">
                                    <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i> Verificar agora
                                </button>
                            </div>
                        </section>
                    </div>

                    <!-- Tab: Backup -->
                    <div id="settings-backup"
                        class="settings-content hidden space-y-8 animate__animated animate__fadeIn">
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Exportar
                                Dados</h4>
                            <p class="text-xs text-zinc-500 mb-4">Baixe um arquivo JSON contendo todas as suas notas,
                                workspaces e configurações.</p>
                            <button onclick="triggerBackup()"
                                class="w-full py-3 bg-zinc-800 hover:bg-zinc-700 text-zinc-100 rounded-lg border border-zinc-700 flex items-center justify-center gap-2 transition-all">
                                <i data-lucide="download" class="w-4 h-4"></i> Criar Backup Local
                            </button>
                        </section>
                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Importar</h4>
                            <div
                                class="border-2 border-dashed border-zinc-800 hover:border-zinc-600 rounded-lg p-8 text-center transition-colors cursor-pointer">
                                <i data-lucide="upload-cloud" class="w-8 h-8 text-zinc-600 mx-auto mb-2"></i>
                                <span class="text-xs text-zinc-500">Arraste um arquivo .json ou clique para
                                    selecionar</span>
                            </div>
                        </section>
                    </div>

                    <!-- Tab: Advanced -->
                    <div id="settings-advanced"
                        class="settings-content hidden space-y-8 animate__animated animate__fadeIn">
                        <div class="bg-amber-900/10 border border-amber-900/50 rounded-lg p-4 mb-4">
                            <h4 class="text-amber-500 font-bold flex items-center gap-2 text-sm"><i
                                    data-lucide="alert-triangle" class="w-4 h-4"></i> Zona de Perigo</h4>
                            <p class="text-[10px] text-amber-200/60 mt-1">Alterações aqui podem quebrar o sistema. Faça
                                backup antes de editar.</p>
                        </div>

                        <section>
                            <h4 class="text-sm font-bold text-zinc-200 mb-4 border-b border-zinc-800 pb-2">Comportamento
                                de Workspaces</h4>
                            <div class="flex items-center justify-between py-2">
                                <div>
                                    <p class="text-sm text-zinc-300">Auto-adicionar Pastas</p>
                                    <p class="text-[10px] text-zinc-500">Ao abrir uma pasta local, criar automaticamente
                                        um Workspace para ela.</p>
                                </div>
                                <div id="toggle-auto-add" onclick="toggleAutoAddFolder()"
                                    class="w-10 h-5 bg-zinc-700 rounded-full relative cursor-pointer transition-colors">
                                    <div
                                        class="absolute left-0.5 top-0.5 w-4 h-4 bg-zinc-400 rounded-full transition-transform">
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="flex flex-col h-[400px]">
                            <h4
                                class="text-sm font-bold text-zinc-200 mb-2 border-b border-zinc-800 pb-2 flex justify-between items-center">
                                Configuração do Sistema (JSON)
                                <button onclick="saveSystemConfig()"
                                    class="text-[10px] bg-blue-600 hover:bg-blue-500 text-white px-2 py-1 rounded">Salvar
                                    & Recarregar</button>
                            </h4>
                            <textarea id="system-config-json"
                                class="flex-1 bg-zinc-950 border border-zinc-800 rounded-lg p-3 font-mono text-xs text-zinc-300 focus:outline-none focus:border-zinc-600 resize-none custom-scrollbar"
                                spellcheck="false"></textarea>
                        </section>
                    </div>

                </div>
            </main>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal"
        class="fixed inset-0 bg-black/80 z-[90] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster">
        <div
            class="glass p-6 rounded-xl w-full max-w-sm border border-red-900/50 shadow-2xl animate__animated animate__zoomIn animate__faster">
            <h3 class="text-lg font-bold text-zinc-100 mb-1 flex items-center gap-2"><i data-lucide="alert-circle"
                    class="text-red-500"></i> Excluir Arquivo?</h3>
            <p class="text-xs text-zinc-400 mb-6">O que você deseja fazer com <span id="delete-filename"
                    class="font-bold text-zinc-200">arquivo.txt</span>?</p>

            <div class="space-y-3">
                <button onclick="confirmDeleteAction('remove')"
                    class="w-full flex items-center justify-between px-4 py-3 bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 rounded-lg transition-all group">
                    <span class="text-xs font-semibold text-zinc-300 group-hover:text-zinc-100">Remover do Cromva</span>
                    <span class="text-[10px] text-zinc-500">Mantém no disco</span>
                </button>

                <button onclick="confirmDeleteAction('disk')" id="btn-delete-disk"
                    class="w-full flex items-center justify-between px-4 py-3 bg-red-900/10 hover:bg-red-500/20 border border-red-900/30 hover:border-red-500/50 rounded-lg transition-all group">
                    <span class="text-xs font-semibold text-red-400 group-hover:text-red-300">Excluir do Disco</span>
                    <span class="text-[10px] text-red-500/60 group-hover:text-red-400">Irreversível</span>
                </button>
            </div>

            <div class="flex justify-center mt-6">
                <button onclick="closeDeleteModal()"
                    class="text-xs text-zinc-500 hover:text-zinc-300 underline underline-offset-2">Cancelar</button>
            </div>
        </div>
    </div>

    </div>

    <!-- Import Modal -->
    <div id="import-modal"
        class="fixed inset-0 bg-black/80 z-[90] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster"
        onclick="document.getElementById('import-modal').classList.add('hidden'); document.getElementById('import-modal').classList.remove('flex')">
        <div class="glass p-6 rounded-xl w-full max-w-sm border border-zinc-700 shadow-2xl animate__animated animate__zoomIn animate__faster"
            onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold text-zinc-100 mb-4 flex items-center gap-2"><i data-lucide="import"
                    class="w-5 h-5 text-blue-500"></i> Importar para Workspace</h3>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="handleImport('file')"
                    class="flex flex-col items-center justify-center gap-3 p-6 bg-zinc-900/50 hover:bg-zinc-800 border border-zinc-800 hover:border-blue-500/50 rounded-xl transition-all group">
                    <div
                        class="w-12 h-12 rounded-full bg-zinc-800 group-hover:bg-blue-500/10 flex items-center justify-center transition-colors">
                        <i data-lucide="file-plus" class="w-6 h-6 text-zinc-400 group-hover:text-blue-400"></i>
                    </div>
                    <span class="text-xs font-bold text-zinc-300 group-hover:text-blue-100">Selecionar Arquivo</span>
                </button>

                <button onclick="handleImport('folder')"
                    class="flex flex-col items-center justify-center gap-3 p-6 bg-zinc-900/50 hover:bg-zinc-800 border border-zinc-800 hover:border-emerald-500/50 rounded-xl transition-all group">
                    <div
                        class="w-12 h-12 rounded-full bg-zinc-800 group-hover:bg-emerald-500/10 flex items-center justify-center transition-colors">
                        <i data-lucide="folder-plus" class="w-6 h-6 text-zinc-400 group-hover:text-emerald-400"></i>
                    </div>
                    <span class="text-xs font-bold text-zinc-300 group-hover:text-emerald-100">Selecionar Pasta</span>
                </button>
            </div>

            <p class="text-[10px] text-zinc-500 text-center mt-6">O conteúdo será adicionado ao workspace atual.</p>
        </div>
    </div>

    <!-- Spotlight Overlay -->
    <div id="spotlight-overlay"
        class="fixed inset-0 bg-black/60 z-[100] hidden items-start justify-center pt-[15vh] backdrop-blur-sm animate__animated animate__fadeIn animate__faster">
        <div class="glass w-full max-w-2xl rounded-xl border border-zinc-700 shadow-2xl flex flex-col overflow-hidden animate__animated animate__zoomIn animate__faster"
            onclick="event.stopPropagation()">

            <div class="flex items-center gap-3 px-4 py-3 border-b border-zinc-800 bg-zinc-900/80">
                <i data-lucide="search" class="w-5 h-5 text-zinc-400"></i>
                <input id="spotlight-input" type="text"
                    placeholder="Digite para buscar arquivos, calcular ou converter..."
                    class="flex-1 bg-transparent border-none text-zinc-100 text-lg focus:outline-none placeholder-zinc-600"
                    autocomplete="off" spellcheck="false">
                <span
                    class="text-[10px] bg-zinc-800 px-1.5 py-0.5 rounded text-zinc-500 font-mono border border-zinc-700">ESC</span>
            </div>

            <div id="spotlight-results" class="max-h-[60vh] overflow-y-auto custom-scrollbar p-2 bg-[#09090b]">
                <!-- Results injected here -->
                <div class="py-12 text-center text-zinc-500 flex flex-col items-center gap-3 opacity-50">
                    <i data-lucide="command" class="w-8 h-8 opacity-20"></i>
                    <p class="text-sm">O que você procura hoje?</p>
                </div>
            </div>

            <div
                class="px-3 py-1.5 bg-zinc-900/90 border-t border-zinc-800 flex justify-between items-center text-[10px] text-zinc-500">
                <div class="flex gap-3">
                    <span class="flex items-center gap-1"><i data-lucide="arrow-up" class="w-3 h-3"></i><i
                            data-lucide="arrow-down" class="w-3 h-3"></i> Navegar</span>
                    <span class="flex items-center gap-1"><i data-lucide="corner-down-left" class="w-3 h-3"></i>
                        Selecionar</span>
                </div>
                <div>
                    <span class="bg-blue-500/10 text-blue-400 px-1.5 py-0.5 rounded">Math</span>
                    <span class="bg-emerald-500/10 text-emerald-400 px-1.5 py-0.5 rounded ml-1">Files</span>
                    <span class="bg-amber-500/10 text-amber-400 px-1.5 py-0.5 rounded ml-1">Wiki</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Wiki Modal -->
    <div id="wiki-modal"
        class="fixed inset-0 bg-black/80 z-[110] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster"
        onclick="document.getElementById('wiki-modal').classList.add('hidden'); document.getElementById('wiki-modal').classList.remove('flex')">
        <div class="glass w-full max-w-3xl max-h-[80vh] rounded-xl flex flex-col border border-zinc-700 shadow-2xl overflow-hidden animate__animated animate__zoomIn animate__faster"
            onclick="event.stopPropagation()">
            <header
                class="h-14 border-b border-zinc-800 flex items-center justify-between px-6 bg-zinc-900/90 backdrop-blur">
                <div class="flex items-center gap-3">
                    <i data-lucide="book" class="w-5 h-5 text-pink-500"></i>
                    <h3 id="wiki-title" class="text-zinc-100 font-bold text-lg truncate w-96">Wikipédia</h3>
                </div>
                <div class="flex items-center gap-2">
                    <a id="wiki-link" href="#" target="_blank"
                        class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100 transition-colors"
                        title="Abrir no navegador">
                        <i data-lucide="external-link" class="w-4.5 h-4.5"></i>
                    </a>
                    <button
                        onclick="document.getElementById('wiki-modal').classList.add('hidden'); document.getElementById('wiki-modal').classList.remove('flex')"
                        class="p-2 hover:bg-zinc-800 rounded-md text-zinc-400 hover:text-zinc-100 transition-colors">
                        <i data-lucide="x" class="w-4.5 h-4.5"></i>
                    </button>
                </div>
            </header>
            <div id="wiki-content"
                class="flex-1 p-8 overflow-y-auto custom-scrollbar text-zinc-300 leading-relaxed space-y-4">
                <!-- Content injected here -->
            </div>
        </div>
    </div>

    <!-- Modules -->
    <script src="js/core/state.js"></script>
    <script src="js/core/fs_handler.js"></script>
    <script src="js/utils/helpers.js"></script>

    <!-- Independent Features -->
    <script src="js/spotlight.js"></script>

    <!-- UI & Navigation -->
    <script src="js/ui/navigation.js"></script>

    <!-- Features -->
    <script src="js/features/editor.js"></script>
    <script src="js/features/graph.js"></script>
    <script src="js/features/canvas.js"></script>
    <script src="js/features/workspaces.js"></script>
    <script src="js/features/settings.js"></script>
    <script src="js/features/location_picker.js"></script>

    <!-- Main Entry Point -->
    <script src="js/main.js"></script>
    <!-- Location Picker Modal -->
    <div id="location-picker-modal"
        class="fixed inset-0 bg-black/80 z-[80] hidden items-center justify-center backdrop-blur-sm animate__animated animate__fadeIn animate__faster">
        <div
            class="glass p-6 rounded-xl w-full max-w-lg border border-zinc-700 shadow-2xl animate__animated animate__zoomIn animate__faster">
            <h3 class="text-lg font-bold text-zinc-100 mb-1">Selecionar Local</h3>
            <p class="text-xs text-zinc-500 mb-4">Escolha onde salvar esta nota.</p>

            <!-- Workspace List -->
            <div class="mb-4">
                <label class="text-[10px] uppercase font-bold text-zinc-500 tracking-wider mb-2 block">Workspace</label>
                <div id="lp-workspace-list" class="flex gap-2 overflow-x-auto pb-2 custom-scrollbar">
                    <!-- Injected via JS -->
                </div>
            </div>

            <!-- Folder List -->
            <div class="mb-6">
                <label class="text-[10px] uppercase font-bold text-zinc-500 tracking-wider mb-2 block">Pasta</label>
                <div id="lp-folder-list" class="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto custom-scrollbar p-1">
                    <!-- Injected via JS -->
                </div>
            </div>

            <div class="flex justify-end gap-2 border-t border-zinc-800 pt-4">
                <button onclick="LocationPicker.close()"
                    class="px-3 py-2 text-xs font-medium text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800 rounded-md transition-colors">Cancelar</button>
                <button onclick="LocationPicker.confirm()"
                    class="px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md text-xs font-semibold shadow-lg shadow-blue-900/20 transition-all">Confirmar</button>
            </div>
        </div>
    </div>

</body>

</html>